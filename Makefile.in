#command aliases
CXX := @CXX@ #compile (this will be set based on the platform in configuration)
MV := mv -f #move
RM := rm -f #remove

all:
#compiler flags
CXXFLAGS := -O3 -Wall -I ./include -std=c++11
#external libraries
libs := 
#object files to link
objects := \
	src/roaring.o \
	src/pugixml.o \
	src/local_stemma.o \
	src/variation_unit.o \
	src/apparatus.o \
	src/set_cover_solver.o \
	src/witness.o \
	src/global_stemma.o \

#compile each object from its implementation file and all header files:
src/roaring.o : src/roaring.c include/roaring.h include/roaring.hh
	${CXX} ${CXXFLAGS} -c -o $@ $<
src/pugixml.o : src/pugixml.cpp include/pugixml.h include/pugiconfig.h
	${CXX} ${CXXFLAGS} -c -o $@ $<
src/set_cover_solver.o : src/set_cover_solver.cpp include/set_cover_solver.h include/roaring.hh
	${CXX} ${CXXFLAGS} -c -o $@ $<
src/local_stemma.o : src/local_stemma.cpp include/local_stemma.h
	${CXX} ${CXXFLAGS} -c -o $@ $<
src/variation_unit.o : src/variation_unit.cpp include/variation_unit.h include/witness.h include/local_stemma.h
	${CXX} ${CXXFLAGS} -c -o $@ $<
src/apparatus.o : src/apparatus.cpp include/apparatus.h include/variation_unit.h
	${CXX} ${CXXFLAGS} -c -o $@ $<
src/witness.o : src/witness.cpp include/witness.h include/set_cover_solver.h include/apparatus.h
	${CXX} ${CXXFLAGS} -c -o $@ $<
src/global_stemma.o : src/global_stemma.cpp include/global_stemma.h include/witness.h
	${CXX} ${CXXFLAGS} -c -o $@ $<

#executable files
programs := \
	compare_witnesses \
	find_relatives \
	optimize_substemmata \
	print_graphs \

#test files
tests := \
	test/local_stemma_test \
	test/variation_unit_test \
	test/apparatus_test \
	test/witness_test \

#folders generated by executables
generated_dirs := \
	local \
	flow \
	attestations \
	variants \
	global \

#compile all executables from their implementation files, all linked objects, and external libraries:
${programs} : % : src/%.cpp ${objects}
	${CXX} ${CXXFLAGS} -o $@ $< ${objects} ${libs}
	
${tests} : % : %.cpp ${objects}
	${CXX} ${CXXFLAGS} -o $@ $< ${objects} ${libs}

all: ${programs} ${tests} ${objects}

check: #TODO: put test commands here

.PHONY: clean #to prevent make from confusing the target for a file named "clean"

#Remove all files generated by make (e.g., objects, executables) and by the program (generated directories)
clean:
	${RM} ${objects}
	${RM} ${tests}
	${RM} ${programs}
	${RM} -r ${generated_dirs}

#Remove everything but the originally distributed files
distclean: clean
	${RM} configure config.log config.status
	${RM} -r autom4te.cache
	${RM} aclocal.m4
	${RM} Makefile
	